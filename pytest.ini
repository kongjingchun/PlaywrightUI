# ========================================
# pytest 配置文件
# ========================================
# 该文件定义 pytest 的运行参数和选项
# 
# 使用方法：
#   pytest                          # 运行所有测试
#   pytest -m smoke                 # 只运行冒烟测试
#   pytest -m "not slow"            # 排除慢速测试
#   pytest --headed                 # 有头模式运行
#   pytest --browser=firefox        # 使用 Firefox
# ========================================

[pytest]
# ==================== 测试发现 ====================
# 测试文件匹配模式
python_files = test_*.py *_test.py
# 测试类匹配模式
python_classes = Test*
# 测试函数匹配模式
python_functions = test_*

# 测试目录
testpaths = tests

# ==================== 命令行参数 ====================
# 默认命令行参数（与 config/settings.py 的 REPORTS_DIR 保持一致：UIreport）
# 有头/无头：默认由 config/settings.py 的 HEADLESS 控制，执行时加 --headed 可覆盖
addopts = 
    -v 
    --tb=short 
    --strict-markers
    --alluredir=UIreport

# ==================== 标记定义 ====================
# 定义自定义标记，避免警告
markers =
    smoke: 冒烟测试 - 核心功能验证
    regression: 回归测试 - 完整功能验证
    slow: 慢速测试 - 执行时间较长的测试
    wip: 开发中 - 正在开发的测试（可能不稳定）
    login: 登录相关测试
    search: 搜索相关测试
    api: API 相关测试
    ui: UI 相关测试
    skip_local: 本地环境跳过
    skip_prod: 生产环境跳过

# ==================== 日志配置 ====================
# 控制台实时日志（显示测试过程）
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# 注意：文件日志由 utils/logger.py 管理
# 每次测试运行会生成独立的日志文件：logs/test_YYYYMMDD_HHMMSS.log

# ==================== 其他配置 ====================
# 失败时立即停止（可选，默认关闭）
# addopts = -x

# 失败重跑（需要 pytest-rerunfailures 插件）
# addopts = --reruns 2

# 并行执行（需要 pytest-xdist 插件）
# addopts = -n auto

# ==================== 过滤警告 ====================
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
